<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<body>
  <div id="App"></div>

<script type="text/jsx">

const React = require('react')
const { render } = require('react-dom')
const { AppContainer } = require('react-hot-loader')

// Render with state and action

let App = require('./App')
let action
const { getState, setState, onStateChange } = require('state-stream')()
const el = document.getElementById('App')

const refresh = ({ state }) => {

  action = (name, props = {}) =>
    App.actions[name]({ state, setState, action, ...props })

  render(
    <AppContainer>
      <App {...{ state, setState, action }}/>
    </AppContainer>
    , el
  )
}

onStateChange(state => refresh({ state }))
setState(App.initState || {})

App.actions.init()

// Hot-module replacement

if (module.hot) module.hot.accept(() => {
  App.actions.beforeReload()
  App = require('./App')
  refresh({ state: getState() })
  App.actions.afterReload()
})
</script>

</body>
</html>